<!DOCTYPE html>
<html>
<head><meta charset="utf-8">
  <title>test</title>
  <link rel="stylesheet" href="css/main.css">
  <script src="js/vendor/jquery.js"></script>
  <script src="js/vendor/knockout.debug.js"></script>
  <script src="js/vendor/underscore.js"></script>
  <script src="js/vendor/underscore.string.js"></script>
  <script src="js/vendor/three.js"></script>
  <script src="js/TrackballControl.js"></script>
  <script src="js/mylib.js"></script>
  <script> window._s = _.string; </script>
  <style type="text/css">
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    .controller {
      position: fixed;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
<div id="container"></div>
<div class="controller" id="controller">
  <button class="go goLeft">left</button>
  <button class="go goRight">right</button>
  <button class="go goUp">up</button>
  <button class="go goDown">down</button>
</div>
<script>
// なにか
// ====================

var gLoader = new GroundMeshLoader();



// シーン
// ====================

var scene = new THREE.Scene();
// scene.fog = new THREE.Fog(0xeeeeff, 100, 1500);



// 地表
// ====================

var ground = gLoader.load({
  x: 14271, y: 6531,
  // latitude: 34.25501725339201, longitude: 133.58739852905273,
  roughness: 0
});

// var ground = new THREE.Mesh(
//   new THREE.PlaneGeometry(1.7 * 1000, 1.7 * 1000, 2, 2),
//   new THREE.MeshBasicMaterial({color: 0xff00ff})
// );
// ground.position.y = 0;
// ground.rotation.x = Math.PI / -2;

scene.add(ground);


// 大気
// ====================

// var atmospere = new THREE.Mesh(
//   new THREE.SphereGeometry(500, 60, 40),
//   new THREE.MeshBasicMaterial({color: 0xeeeeff})
// );
// atmospere.scale.x = -1;
// scene.add(atmospere);



// 四角形
// ====================

var cube = new THREE.Mesh(
  new THREE.CubeGeometry(1, 1, 1),
  new THREE.MeshBasicMaterial({color: 0x00ff00})
);
cube.position = new THREE.Vector3(0, 0, 0);
cube.position.add(ground.position);
scene.add(cube);



// レンダラー
// ====================

var renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.getElementById('container').appendChild(renderer.domElement);



// カメラ・コントロール
// ====================

var camera = new THREE.PerspectiveCamera(
  70,
  window.innerWidth / window.innerHeight,
  1,
  30 * 1000
);
scene.add(camera);

var controls = new THREE.TrackballControls(
  camera,
  renderer.domElement
);
camera.position = new THREE.Vector3(1000, 1000, 1000);
camera.position.add(cube.position);
controls.target = cube.position;

var moveStates = {
  left: false,
  right: false,
  up: false,
  down: false
};

function updateCamera() {
  if (moveStates.left)  {
    camera.position.x -= 20;
    controls.target.x -= 20;
  }
  if (moveStates.right) {
    camera.position.x += 20;
    controls.target.x += 20;
  }
  if (moveStates.up)    {
    camera.position.z -= 20;
    controls.target.z -= 20;
  }
  if (moveStates.down)  {
    camera.position.z += 20;
    controls.target.z += 20;
  }
}

function render() {
  controls.update();
  updateCamera();
  renderer.render(scene, camera);
}

requestAnimationFrame(function animate() {
  requestAnimationFrame(animate);
  render();
});


$(function() {
  ControllerView = Backbone.View.extend({
    el: '#controller',
    events: {
      'mousedown .goLeft' : 'goLeft',
      'mousedown .goRight': 'goRight',
      'mousedown .goUp'   : 'goUp',
      'mousedown .goDown' : 'goDown',

      'mouseup .go': 'stop'
    },

    goLeft : function() {moveStates.left  = true;},
    goRight: function() {moveStates.right = true;},
    goUp   : function() {moveStates.up    = true;},
    goDown : function() {moveStates.down  = true;},

    stop: function() {
      moveStates.left  = false;
      moveStates.right = false;
      moveStates.up    = false;
      moveStates.down  = false;
    }
  });

  window.views = {
    controller: new ControllerView()
  }
});

</script>
</body>
</html>
